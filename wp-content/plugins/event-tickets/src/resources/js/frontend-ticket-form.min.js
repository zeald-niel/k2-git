var tribe_tickets_ticket_form={};!function(t,e){var _,i;e.init=function(){_=t(".tribe-events-tickets"),i=_.find(".quantity").find(".qty"),i.on("change",e.on_quantity_change)},e.on_quantity_change=function(){var _=t(this),i=e.get_matching_ticket_id(this);e.ticket_uses_global_stock(i)?e.global_stock_quantity_changed(_,i):e.normal_stock_quantity_changed(_,i)},e.global_stock_quantity_changed=function(t,_){var i=t.val(),a=e.get_event_id(_),c=e.get_cap(_),n=e.get_global_stock(a),o=e.currently_requested_global_event_stock(a);o>n&&(i-=o-n),e.stock_mode_is_capped(_)&&i>c&&(i=c),0>=i&&(i=0),t.val(i),e.update_available_stock_counts(a)},e.normal_stock_quantity_changed=function(i,a){var c,n=i.val(),o=e.get_single_stock(a);t.isNumeric(o)&&(n>o&&(n=o),i.val(n),c=o-n,_.find(".available-stock[data-product-id="+a+"]").html(c))},e.update_available_stock_counts=function(i){var a=e.get_tickets_of(i),c=e.get_global_stock(i)-e.currently_requested_global_event_stock(i);for(var n in a)if(a.hasOwnProperty(n)){c<0&&(c=0);var o=a[n];if("global"===o.mode&&_.find(".available-stock[data-product-id="+n+"]").html(c),"capped"===o.mode){var r=Math.min(c,o.cap),s=parseInt(t("[data-product-id="+n+"]").find("input").val(),10),d=o.cap-s;d<0?d=0:d>r&&(d=r),_.find(".available-stock[data-product-id="+n+"]").html(d)}}},e.get_matching_ticket_id=function(e){var _=t(e).closest("[data-product-id]");if(_.length)return _.data("product-id")},e.get_ticket_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var _=tribe_tickets_stock_data.tickets[t];return"undefined"!=typeof tribe_tickets_stock_data.tickets[t]&&_[e]},e.get_tickets_of=function(t){if("object"!=typeof tribe_tickets_stock_data)return!1;var e=[];for(var _ in tribe_tickets_stock_data.tickets){var i=tribe_tickets_stock_data.tickets[_];t===i.event_id&&(e[_]=i)}return e},e.currently_requested_global_event_stock=function(i){var a=0,c=(e.get_tickets_of(i),_.find(".available-stock"));return c.each(function(e,_){var i=t(_),c=i.data("productId"),n=["global","capped"],o=tribe_tickets_stock_data.tickets[c].mode;if(-1!==n.indexOf(o)){var r=i.parents("tr").eq(0).find(".qty"),s=parseInt(r.val(),10);a+=s}}),a},e.get_event_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var _=tribe_tickets_stock_data.events[t];return"undefined"!==tribe_tickets_stock_data.events[t]&&_[e]},e.stock_mode_is_global=function(t){return"global"===e.get_mode(t)},e.stock_mode_is_capped=function(t){return"capped"===e.get_mode(t)},e.ticket_uses_global_stock=function(t){return e.stock_mode_is_capped(t)||e.stock_mode_is_global(t)},e.get_mode=function(t){return e.get_ticket_property(t,"mode")},e.get_event_id=function(t){return e.get_ticket_property(t,"event_id")},e.get_cap=function(t){return e.get_ticket_property(t,"cap")},e.get_global_stock=function(t){return e.get_event_property(t,"stock")},e.get_single_stock=function(t){return e.get_ticket_property(t,"stock")},t(function(){e.init()}),t(document).on("click",".button-events-list",function(t){t.preventDefault();var e=t.target.parentElement.action;window.location=e})}(jQuery,tribe_tickets_ticket_form);