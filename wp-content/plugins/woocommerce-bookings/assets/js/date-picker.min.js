wc_bookings_date_picker={},jQuery(function(a){var b=0,c={init:function(){a("body").on("change","#wc_bookings_field_duration, #wc_bookings_field_resource",this.date_picker_init),a("body").on("click",".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date",this.toggle_calendar),a("body").on("input",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_trigger),a("body").on("keypress",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_keypress),a("body").on("keypress",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_keypress),a("body").on("change",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_trigger),a(".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date").show(),a(".wc-bookings-date-picker").each(function(){var b=a(this).closest("form"),c=b.find(".picker"),d=a(this).closest("fieldset");wc_bookings_date_picker.date_picker_init(c),"always_visible"==c.data("display")?(a(".wc-bookings-date-picker-date-fields",d).hide(),a(".wc-bookings-date-picker-choose-date",d).hide()):c.hide(),c.data("is_range_picker_enabled")&&(b.find("p.wc_bookings_field_duration").hide(),b.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==c.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date))})},calc_duration:function(a){var b=a.closest("form"),c=a.closest("fieldset"),d=a.data("duration-unit");setTimeout(function(){var a=1,e=parseInt(c.find("input.booking_to_date_year").val(),10),f=parseInt(c.find("input.booking_to_date_month").val(),10),g=parseInt(c.find("input.booking_to_date_day").val(),10),h=parseInt(c.find("input.booking_date_year").val(),10),i=parseInt(c.find("input.booking_date_month").val(),10),j=parseInt(c.find("input.booking_date_day").val(),10);if(e&&f>=0&&g&&h&&i>=0&&j){var k=new Date(Date.UTC(h,i-1,j)),l=new Date(Date.UTC(e,f-1,g));a=Math.floor((l.getTime()-k.getTime())/864e5),"day"===d&&(a+=1)}b.find("#wc_bookings_field_duration").val(a).change()})},toggle_calendar:function(){$picker=a(this).closest("fieldset").find(".picker:eq(0)"),wc_bookings_date_picker.date_picker_init($picker),$picker.slideToggle()},input_date_keypress:function(){var c=a(this).closest("fieldset"),d=c.find(".picker:eq(0)");d.data("is_range_picker_enabled")&&(clearTimeout(b),b=setTimeout(wc_bookings_date_picker.calc_duration(d),800))},input_date_trigger:function(){var b=a(this).closest("fieldset"),c=b.find(".picker:eq(0)"),d=(a(this).closest("form"),parseInt(b.find("input.booking_date_year").val(),10)),e=parseInt(b.find("input.booking_date_month").val(),10),f=parseInt(b.find("input.booking_date_day").val(),10);if(d&&e&&f){var g=new Date(d,e-1,f);if(c.datepicker("setDate",g),c.data("is_range_picker_enabled")){var h=parseInt(b.find("input.booking_to_date_year").val(),10),i=parseInt(b.find("input.booking_to_date_month").val(),10),j=parseInt(b.find("input.booking_to_date_day").val(),10),k=new Date(h,i-1,j);!k||g>k?(b.find("input.booking_to_date_year").val("").addClass("error"),b.find("input.booking_to_date_month").val("").addClass("error"),b.find("input.booking_to_date_day").val("").addClass("error")):b.find("input").removeClass("error")}b.triggerHandler("date-selected",g)}},select_date_trigger:function(b){var c=a(this).closest("fieldset"),d=c.find(".picker:eq(0)"),e=a(this).closest("form"),f=b.split("-"),g=d.data("start_or_end_date");d.data("is_range_picker_enabled")&&g||(g="start"),"end"===g?(d.data("min_date",d.data("o_min_date")),c.find("input.booking_to_date_year").val(f[0]),c.find("input.booking_to_date_month").val(f[1]),c.find("input.booking_to_date_day").val(f[2]).change(),d.data("is_range_picker_enabled")&&wc_bookings_date_picker.calc_duration(d),d.data("start_or_end_date","start"),d.data("is_range_picker_enabled")&&e.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==d.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date),"always_visible"!==d.data("display")&&a(this).hide()):(d.data("is_range_picker_enabled")&&(d.data("o_min_date",d.data("min_date")),d.data("min_date",b)),c.find("input.booking_to_date_year").val(""),c.find("input.booking_to_date_month").val(""),c.find("input.booking_to_date_day").val(""),c.find("input.booking_date_year").val(f[0]),c.find("input.booking_date_month").val(f[1]),c.find("input.booking_date_day").val(f[2]).change(),d.data("is_range_picker_enabled")&&wc_bookings_date_picker.calc_duration(d),d.data("start_or_end_date","end"),d.data("is_range_picker_enabled")&&e.find(".wc_bookings_field_start_date legend span.label").text(booking_form_params.i18n_end_date),"always_visible"===d.data("display")||d.data("is_range_picker_enabled")||a(this).hide()),c.triggerHandler("date-selected",b,g)},date_picker_init:function(b){var c;c=a(b).is(".picker")?a(b):a(this).closest("form").find(".picker"),c.empty().removeClass("hasDatepicker").datepicker({dateFormat:a.datepicker.ISO_8601,showWeek:!1,showOn:!1,beforeShowDay:wc_bookings_date_picker.is_bookable,onSelect:wc_bookings_date_picker.select_date_trigger,minDate:c.data("min_date"),maxDate:c.data("max_date"),defaultDate:c.data("default_date"),numberOfMonths:1,showButtonPanel:!1,showOtherMonths:!0,selectOtherMonths:!0,closeText:wc_bookings_booking_form.closeText,currentText:wc_bookings_booking_form.currentText,prevText:wc_bookings_booking_form.prevText,nextText:wc_bookings_booking_form.nextText,monthNames:wc_bookings_booking_form.monthNames,monthNamesShort:wc_bookings_booking_form.monthNamesShort,dayNames:wc_bookings_booking_form.dayNames,dayNamesShort:wc_bookings_booking_form.dayNamesShort,dayNamesMin:wc_bookings_booking_form.dayNamesMin,firstDay:wc_bookings_booking_form.firstDay,gotoCurrent:!0}),a(".ui-datepicker-current-day").removeClass("ui-datepicker-current-day");var d=c.closest("form"),e=parseInt(d.find("input.booking_date_year").val(),10),f=parseInt(d.find("input.booking_date_month").val(),10),g=parseInt(d.find("input.booking_date_day").val(),10);if(e&&f&&g){var h=new Date(e,f-1,g);c.datepicker("setDate",h)}},get_input_date:function(a,b){var c=a.find("input.booking_"+b+"date_year"),d=a.find("input.booking_"+b+"date_month"),e=a.find("input.booking_"+b+"date_day");return 0!==c.val().length&&0!==d.val().length&&0!==e.val().length?c.val()+"-"+d.val()+"-"+e.val():""},is_bookable:function(b){var c=a(this).closest("form"),d=c.find(".picker:eq(0)"),e=a(this).data("availability"),f=a(this).data("default-availability"),g=a(this).data("fully-booked-days"),h=a(this).data("buffer-days"),i=a(this).data("partially-booked-days"),j=(wc_bookings_booking_form.check_availability_against,""),k="",l=0,m=wc_bookings_booking_form.resources_assignment;c.find("select#wc_bookings_field_resource").val()>0&&(l=c.find("select#wc_bookings_field_resource").val());var n=wc_bookings_booking_form.booking_duration,o=new Date(b),p=o.getFullYear(),q=o.getMonth()+1,r=o.getDate(),s=p+"-"+q+"-"+r;if(g[s]){if(g[s][0]||g[s][l])return[!1,"fully_booked",booking_form_params.i18n_date_fully_booked];"automatic"===m&&(j+="partial_booked ")}if(h&&h&&h[s])return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];if(""+p+q+r<wc_bookings_booking_form.current_time)return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];i&&i[s]&&("automatic"===m||i[s][0]||i[s][l])&&(j+="partial_booked ");var t=wc_bookings_date_picker.get_number_of_days(n,c,d,wc_bookings_booking_form),u={start_date:b,number_of_days:t,fully_booked_days:g,availability:e,default_availability:f,resource_id:l,resources_assignment:m},v=wc_bookings_date_picker.is_blocks_bookable(u);if(v){if(k=j.indexOf("partial_booked")>-1?booking_form_params.i18n_date_partially_booked:booking_form_params.i18n_date_available,d.data("is_range_picker_enabled")){var w=a(this).closest("fieldset"),x=a.datepicker.parseDate(a.datepicker.ISO_8601,wc_bookings_date_picker.get_input_date(w,"")),y=a.datepicker.parseDate(a.datepicker.ISO_8601,wc_bookings_date_picker.get_input_date(w,"to_"));return[v,x&&(b.getTime()===x.getTime()||y&&b>=x&&y>=b)?j+"bookable-range":j+"bookable",k]}return[v,j+"bookable",k]}return[v,g[s]?"fully_booked":"not_bookable",booking_form_params.i18n_date_unavailable]},get_number_of_days:function(a,b,c,d){var e=a,f=d;if(b.find("#wc_bookings_field_duration").length>0&&"minute"!=f.duration_unit&&"hour"!=f.duration_unit&&!c.data("is_range_picker_enabled")){var g=b.find("#wc_bookings_field_duration").val();e*=g}return(1>e||"start"===f.check_availability_against)&&(e=1),e},is_blocks_bookable:function(b){for(var c=b.default_availability,d=0;d<b.number_of_days;d++){var e=new Date(b.start_date);e.setDate(e.getDate()+d);var f=e.getFullYear(),g=e.getMonth()+1,h=e.getDate(),i=e.getDay();a.datepicker.iso8601Week(e);0===i&&(i=7);var j={date:e,default_availability:b.default_availability},k=b.availability[b.resource_id];if(c=wc_bookings_date_picker.is_resource_available_on_date(j,k),"automatic"===b.resources_assignment){var l=a.extend({availability:b.availability,fully_booked_days:b.fully_booked_days},j);c=wc_bookings_date_picker.has_available_resource(l)}var m=f+"-"+g+"-"+h;if(b.fully_booked_days[m]&&(b.fully_booked_days[m][0]||b.fully_booked_days[m][b.resource_id])&&(c=!1),!c)break}return c},is_resource_available_on_date:function(b,c){if("object"!=typeof b||"object"!=typeof c)return!1;var d=b.default_availability,e=b.date.getFullYear(),f=b.date.getMonth()+1,g=b.date.getDate(),h=b.date.getDay(),i=new Date(e,0,1),j=Math.ceil(((b.date-i)/864e5+i.getDay()+1)/7);if(0===h&&(h=7),b.fully_booked_days&&b.fully_booked_days[e+"-"+f+"-"+g]&&b.fully_booked_days[e+"-"+f+"-"+g][b.resource_id])return!1;var k=[],l=_.range(1,1440,1);return d&&(k=l),a.each(c,function(a,b){var c=b.type,d=b.range;try{switch(c){case"months":if("undefined"!=typeof d[f])return k=d[f]?l:[],!0;break;case"weeks":if("undefined"!=typeof d[j])return k=d[j]?l:[],!0;break;case"days":if("undefined"!=typeof d[h])return k=d[h]?l:[],!0;break;case"custom":if("undefined"!=typeof d[e][f][g])return k=d[e][f][g]?l:[],!0;break;case"time":case"time:1":case"time:2":case"time:3":case"time:4":case"time:5":case"time:6":case"time:7":if(h===d.day||0===d.day){var i=parseInt(d.from.split(":")[0]),m=parseInt(d.from.split(":")[1]),n=parseInt(d.to.split(":")[0]),o=parseInt(d.to.split(":")[1]),p=m+60*i,q=o+60*n,r=_.range(p,q,1);return k=d.rule?_.union(k,r):_.difference(k,r),!0}break;case"time:range":d=d[e][f][g];var i=parseInt(d.from.split(":")[0]),m=parseInt(d.from.split(":")[1]),n=parseInt(d.to.split(":")[0]),o=parseInt(d.to.split(":")[1]),p=m+60*i,q=o+60*n,r=_.range(p,q,1);k=d.rule?_.union(k,r):_.difference(k,r)}}catch(s){return!0}}),!_.isEmpty(k)},get_week_number:function(a){var b=new Date(a.getFullYear(),0,1),c=Math.ceil(((a-b)/864e5+b.getDay()+1)/7);return c},has_available_resource:function(a){for(var b in a.availability)if(b=parseInt(b,10),0!==b){var c=a.availability[b];if(a.resource_id=b,wc_bookings_date_picker.is_resource_available_on_date(a,c))return!0}return!1}};wc_bookings_date_picker=c,wc_bookings_date_picker.init()});